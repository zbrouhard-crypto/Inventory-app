
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Service Vehicle Inventory</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f4f4f9; }
    header { background: #333; color: #fff; padding: 1em; text-align: center; }
    nav { display: flex; justify-content: space-around; background: #444; }
    nav button { flex: 1; padding: 1em; border: none; background: #444; color: #fff; font-size: 1em; }
    nav button.active { background: #666; }
    section { display: none; padding: 1em; }
    section.active { display: block; }
    .group, .part { background: #fff; margin: 0.5em 0; padding: 1em; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .btn { padding: 0.5em 1em; margin: 0.2em; border: none; border-radius: 6px; cursor: pointer; }
    .btn-primary { background: #007bff; color: #fff; }
    .btn-danger { background: #dc3545; color: #fff; }
    .btn-secondary { background: #6c757d; color: #fff; }
    #qr-video { width: 100%; max-width: 400px; margin: 1em auto; display: block; }
    #qr-canvas { margin-top: 1em; }
  </style>
</head>
<body>
  <header>
    <h1>Service Vehicle Inventory</h1>
  </header>

  <nav>
    <button onclick="showSection('home')" class="active">Home</button>
    <button onclick="showSection('groups')">Groups</button>
    <button onclick="showSection('restock')">Restock</button>
    <button onclick="showSection('settings')">Settings</button>
  </nav>

  <section id="home" class="active">
    <h2>Welcome</h2>
    <button class="btn btn-primary" onclick="startScanner()">Scan QR Code</button>
    <video id="qr-video"></video>
    <div id="scan-result"></div>
  </section>

  <section id="groups">
    <h2>Groups</h2>
    <div id="groups-list"></div>
  </section>

  <section id="restock">
    <h2>Restock List</h2>
    <ul id="restock-list"></ul>
    <button class="btn btn-secondary" onclick="clearRestock()">Mark as Restocked</button>
  </section>

  <section id="settings">
    <h2>Settings</h2>
    <button class="btn btn-danger" onclick="downloadData()">Export Data</button>
    <input type="file" id="importFile" onchange="importData(event)" />
  </section>

  <canvas id="qr-canvas" style="display:none;"></canvas>

  <script src="https://unpkg.com/qr-scanner@1.4.2/qr-scanner.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
  <script>
    let groups = [
      { id: 1, name: "Bin 1", parts: [ { name: "1A Fuse", qty: 10 }, { name: "2A Fuse", qty: 10 } ] },
      { id: 2, name: "Bin 2", parts: [ { name: "100A Breaker", qty: 5 }, { name: "150A Breaker", qty: 5 } ] }
    ];
    let restock = [];

    function showSection(id) {
      document.querySelectorAll('section').forEach(sec => sec.classList.remove('active'));
      document.querySelectorAll('nav button').forEach(btn => btn.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      document.querySelector(`nav button[onclick="showSection('${id}')"]`).classList.add('active');
      if (id === "groups") renderGroups();
      if (id === "restock") renderRestock();
    }

    function renderGroups() {
      const list = document.getElementById("groups-list");
      list.innerHTML = "";
      groups.forEach(g => {
        const div = document.createElement("div");
        div.className = "group";
        div.innerHTML = \`
          <h3>\${g.name}</h3>
          <button class="btn btn-primary" onclick="viewGroup(\${g.id})">View</button>
          <button class="btn btn-secondary" onclick="generateQR(\${g.id})">Show QR</button>
        \`;
        list.appendChild(div);
      });
    }

    function viewGroup(id) {
      const group = groups.find(g => g.id === id);
      let html = \`<h3>\${group.name}</h3>\`;
      group.parts.forEach(p => {
        html += \`
          <div class="part">
            \${p.name} - Qty: \${p.qty}
            <button class="btn btn-primary" onclick="usePart(\${id}, '\${p.name}')">Use</button>
          </div>\`;
      });
      document.getElementById("groups-list").innerHTML = html;
    }

    function usePart(groupId, partName) {
      const group = groups.find(g => g.id === groupId);
      const part = group.parts.find(p => p.name === partName);
      if (part.qty > 0) {
        part.qty--;
        restock.push(partName);
        renderRestock();
        viewGroup(groupId);
      }
    }

    function renderRestock() {
      const list = document.getElementById("restock-list");
      list.innerHTML = "";
      const counts = {};
      restock.forEach(item => counts[item] = (counts[item] || 0) + 1);
      Object.entries(counts).forEach(([name, qty]) => {
        const li = document.createElement("li");
        li.textContent = \`\${name} x\${qty}\`;
        list.appendChild(li);
      });
    }

    function clearRestock() {
      restock = [];
      groups.forEach(g => g.parts.forEach(p => p.qty = 10)); // reset to full stock for demo
      renderRestock();
      renderGroups();
    }

    async function generateQR(groupId) {
      const group = groups.find(g => g.id === groupId);
      const canvas = document.getElementById("qr-canvas");
      const qrData = \`INV-GROUP:\${group.id}|\${group.name}\`;
      await QRCode.toCanvas(canvas, qrData, { width: 200 });
      const qrWindow = window.open("", "_blank");
      qrWindow.document.write(\`<h3>\${group.name}</h3>\`);
      qrWindow.document.body.appendChild(canvas.cloneNode(true));
      const btn = qrWindow.document.createElement("button");
      btn.textContent = "Download QR";
      btn.onclick = () => {
        const link = document.createElement("a");
        link.download = \`\${group.name}_QR.png\`;
        link.href = canvas.toDataURL();
        link.click();
      };
      qrWindow.document.body.appendChild(btn);
    }

    async function startScanner() {
      const video = document.getElementById("qr-video");
      const resultDiv = document.getElementById("scan-result");
      const scanner = new QrScanner(video, result => {
        resultDiv.textContent = "Scanned: " + result;
        if (result.startsWith("INV-GROUP:")) {
          const [id, name] = result.replace("INV-GROUP:", "").split("|");
          const group = groups.find(g => g.id == id);
          if (group) {
            viewGroup(group.id);
            showSection("groups");
          }
        }
        scanner.stop();
      });
      scanner.start();
    }

    function downloadData() {
      const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(groups));
      const link = document.createElement("a");
      link.setAttribute("href", dataStr);
      link.setAttribute("download", "inventory.json");
      link.click();
    }

    function importData(event) {
      const file = event.target.files[0];
      const reader = new FileReader();
      reader.onload = e => {
        groups = JSON.parse(e.target.result);
        renderGroups();
      };
      reader.readAsText(file);
    }
  </script>
</body>
</html>
